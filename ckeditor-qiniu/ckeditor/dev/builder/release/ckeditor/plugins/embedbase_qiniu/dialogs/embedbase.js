/*
 Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("embedBaseQiniu",function(e){function m(){g=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"embedQiniuSelectBtnId",uptoken_func:n,get_new_uptoken:!0,domain:qiniu_bucket_domain,container:"embedQiniuSelectBtnContainerId",max_file_size:"40mb",filters:{mime_types:[{title:"Image files",extensions:"mp4,MP4"}]},flash_swf_url:"./Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"embedQiniuSelectBtnContainerId",chunk_size:"4mb",auto_start:!1,multi_selection:!1,init:{FilesAdded:function(a,
b){plupload.each(b,function(a){document.getElementById("embedQiniuFileinfoId").innerHTML+='\x3cdiv id\x3d"'+a.id+'"\x3e'+a.name+"\x26nbsp;\x26nbsp;\x26nbsp;("+plupload.formatSize(a.size)+")\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3cb\x3e\x3c/b\x3e\t\x3ci\x3e\x3c/i\x3e\x3c/div\x3e\x3cbr\x3e"});d=d.concat(b);p()},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,b,c){JSON.parse(c);a=f;document.getElementById(b.id).getElementsByTagName("i")[0].innerHTML=
a;CKEDITOR.dialog.getCurrent().setValueOf("info","url",a)},Error:function(a,b,c){console.log(b+"  tip:"+c)},UploadComplete:function(){},Key:q}})}function p(){if(d&&0!=d.length){var a=d.shift(),b=urlForGetQiniuToken,a=a.type.substring(6);$.ajax({url:b,type:"POST",dataType:"json",data:{tk:smsLoginToken,ft:"."+a}}).done(function(a){console.log("success");console.log(a);var b=a.fn,d=a.url;h=a.tk;k=b;f=d;g.start()}).fail(function(a){console.log("error")}).always(function(){console.log("complete")})}}var l=
e.lang.embedbase_qiniu,g,h,k,f,n=function(){return h},q=function(){return k},d=[];return{title:l.title,minWidth:350,minHeight:50,onLoad:function(){var a=this,b=null;this.on("ok",function(c){c.data.hide=!1;c.stop();a.setState(CKEDITOR.DIALOG_STATE_BUSY);c=a.getValueOf("info","url");a.widget.setVideoContent(c);a.widget.isReady()||e.widgets.finalizeCreation(a.widget.wrapper.getParent(!0));e.fire("saveSnapshot");a.hide();a.setState(CKEDITOR.DIALOG_STATE_IDLE);b=null},null,null,15);this.on("cancel",function(c){c.data.hide&&
b&&(b.cancel(),a.setState(CKEDITOR.DIALOG_STATE_IDLE),b=null)});m()},contents:[{id:"info",elements:[{type:"text",id:"url",label:e.lang.common.url,required:!0,setup:function(a){this.setValue(a.data.url)},validate:function(){return this.getValue()==f?!0:this.getDialog().widget.isUrlValid(this.getValue())?!0:l.unsupportedUrlGiven}},{type:"html",id:"upload",html:'\x3cdiv id\x3d"embedQiniuFileinfoId"\x3e\x3c/div\x3e\x3cdiv id\x3d"embedQiniuSelectBtnContainerId"\x3e\x3ca href\x3d"javascript:void(0)" id\x3d"embedQiniuSelectBtnId"\x3e[点击选择文件]\x3c/a\x3e\x3c/div\x3e'}]}]}});